---
title: "Applied Epi - R setup, syntax, data import"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    css: css/css_custom.css
    theme: "paper"
runtime: shiny_prerendered
description: >
  Learn how to get started with R and RStudio, and how to import a dataset
---

<!-- NOTES: To edit images, edit them in the "images" folder that lives NEXT TO THE RMD FILE -->


<!-- Add JavaScript code for making the exercise code larger -->
<script language="JavaScript" src="js/exercise-font-size.js"></script>

```{r setup, include=FALSE}
library(gradethis)
library(etude)
library(learnr)
library(dplyr)
library(flair)
library(ggplot2)
library(lubridate)
library(fontawesome)
library(janitor)

# set options for exercises and checking ---------------------------------------
gradethis::gradethis_setup()

learnr::tutorial_options(exercise.timelimit = 60)
    # exercise.checker = gradethis::grade_learnr) 
    # alternatively, submitr::null_code_checker

# event recorder ---------------------------------------------------------------
# see https://github.com/dtkaplan/submitr/blob/master/R/make_a_recorder.R

tutorial_options(exercise.eval = FALSE)  # pre-evaluate exercises

# new_recorder <- function(tutorial_id, tutorial_version, user_id, event, data) {
#     cat(
#       tutorial_id, 
#       " (v", tutorial_version, "); ",
#       format(Sys.time(), "%Y-%M%-%D %H:%M:%S %Z"), "; ",
#       user_id, "; ",
#       event, "; ",
#       data$label, "; ",
#       data$answers, "; ",
#       data$code, "; ",
#       data$correct, "\n", sep = "",
#       
#       file = here::here("event_records", "learnr_basics.txt"),
#       append = TRUE)
# }

#options(tutorial.event_recorder = new_recorder)
```


```{r, include=FALSE}
# hide non-exercise code chunks ------------------------------------------------
knitr::opts_chunk$set(echo = FALSE)
```

```{r, include=FALSE}
# data prep --------------------------------------------------------------------
surv_raw <- rio::import(system.file("dat/surveillance_linelist_20141201.csv", package = "introexercises"))
```




## Introduction to R for Applied Epidemiology  


### Welcome

Welcome to the live course "Introduction to R for applied epidemiology", offered by [Applied Epi](www.appliedepi.org) - a nonprofit organisation that offers open-source tools, training, and support to frontline public health practitioners.  

```{r, eval = TRUE, echo = FALSE, out.width = "25%"}
knitr::include_graphics("images/logo.png")
```

### R setup, basic syntax, and importing data  

This exercise focuses on **setting up R for the first time, an introduction to basic R coding, and how to import your dataset into R**.

### Format

This exercise will guide you through a set of tasks.  
*You should perform these tasks in RStudio on your local computer*.  

#### Getting Help  

There are several ways to get help:  

1) Look for the "helpers" (see below)
2) Ask your live course instructor/facilitator for help  
3) Ask a colleague or other participant in the course for tips  
4) Post a question in [Applied Epi Community](www.community.appliedepi.org) in the category for questions about Applied Epi Training  

Here is what those "helpers" will look like:

<!--
NOTE: Below is the hint (all within details tags collapsed)
-->
<details>

<summary style='text-decoration: underline; color: darkgreen;'>`r fontawesome::fa("lightbulb", fill = "gold")` Click to read a hint</summary>
</br>

Here you will see a helpful hint!  

</br>
</details>

<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
linelist %>% 
  filter(
    age > 25,
    district == "Bolo"
  )
```

Here is more explanation about why the solution works.  

</br>
</details>
<!--
NOTE: End of solution
-->


#### Quiz questions  

Please complete the quiz questions that you encounter throughout the tutorial. **Answering will help you** to comprehend the material, and will also help us to improve the exercises for future students.  

To practice, please answer the following questions:  


```{r quiz-use-helper, echo=F}
quiz(
  question_radio("When should I view the red 'helper' code?",
    answer("After trying to write the code myself", correct = TRUE),
    answer("Before I try coding", correct = FALSE),
    correct = "Reviewing best-practice code after trying to write yourself can help you improve",
    incorrect = "Please attempt the exercise yourself, or use the hint, before viewing the answer."
  )
)
```


```{r quiz-anxious, echo = FALSE}
question_numeric(
 "How anxious are you about beginning this tutorial - on a scale from 1 (least anxious) to 10 (most anxious)?",
 answer(10, message = "Try not to worry, we will help you succeed!", correct = T),
 answer(9, message = "Try not to worry, we will help you succeed!", correct = T),
 answer(8, message = "Try not to worry, we will help you succeed!", correct = T),
 answer(7, message = "Try not to worry, we will help you succeed!", correct = T),
 answer(6, message = "Ok, we will get there together", correct = T),
 answer(5, message = "Ok, we will get there together", correct = T),
 answer(4, message = "I like your confidence!", correct = T),
 answer(3, message = "I like your confidence!", correct = T),
 answer(2, message = "I like your confidence!", correct = T),
 answer(1, message = "I like your confidence!", correct = T),
 allow_retry = TRUE,
 correct = "Thanks for sharing. ",
 min = 1,
 max = 10,
 step = 1
)
```



#### Icons  

You will see these icons throughout the exercises:

Icon  |Meaning
------|--------------------
`r fontawesome::fa("eye", fill = "darkblue")`|Observe  
`r fontawesome::fa("exclamation", fill = "red")`|Alert!  
`r fontawesome::fa("pen", fill = "brown")`|An informative note  
`r fontawesome::fa("terminal", fill = "black")`|Time for you to code!  
`r fontawesome::fa("window-restore", fill = "darkgrey")`|Change to another window  
`r fontawesome::fa("bookmark", fill = "orange")`|Remember this for later  





## Learning objectives

In this exercise you will:  

* Become familiar with the panels in the RStudio interface
* Practice opening a new R script and running R code "commands" from an R script
* Learn basic syntax,  operators, and functions  
* Install and load R packages  
* Arrange an R project with well-named files  
* Import a CSV dataset into R, and review it   



## Initial setup  

Prior to beginning this exercise, you completed the initial setup steps to:  

1) Install R and RStudio  
2) Download the course files in the "intro_course" folder to your desktop  
3) Create a new RStudio project in the "intro_course" folder  
4) Download the exercises for this course, including this one  




## Understand R and RStudio  


### Understand R   

**R is a language** used for statistical computing and graphics, developed in 1991 and based on the language S ([read more of the history here](https://bookdown.org/rdpeng/rprogdatascience/history-and-overview-of-r.html#what-is-r)). 

**R is different from other programming languages** in that its original purpose is data analysis.  

**R is distinct from other data analysis languages** because of:  

* It is free (no more license fees!)  
* It has advanced graphics capabilities  
* It has versatile automated reporting capabilities (very useful in public health!)  
* It is open-source (new capabilities are created by the user community)  
* It has a large, growing, and vibrant user community.  

Because R is open-source, its functionalities are expanded by its user community - every day! Users like you can write R code that does a specific task (for example, a template for an outbreak situation report), share it with the world, and others can evaluate and adopt it as needed. Ultimately, this is a robust process with millions of people testing and vetting code. Only the best becomes widely adopted. R is trusted and used by many institutions: for example, the [US Food and Drug Administration (FDA)](https://blog.revolutionanalytics.com/2012/06/fda-r-ok.html).  

R is governed by a "core group" and is updated every few months. Pay attention to the **R version** that you download - each version is assigned a number (like "R version 4.1.2 (2021-11-01)") and a name to make it easier to remember, like "Bird Hippie". To update your version of R, re-download it.  

### R is the vehicle engine

When you install R to your computer, it is an independent software that you can open directly. If you open only R (not RStudio), you will see only one simple panel - the R Console. **This is not how must people use R**. Using R this way will run all the computations and create all the plots you desire, *but it will be difficult to stay organized*.    

**Now, people use Integrated Development Environments (IDEs) such as RStudio** to "wrap around" their R software, allowing a more friendly user interface and file organization.  

You can think of R as being the *engine* of a vehicle, doing the crucial work, and RStudio as the *body* of the vehicle (with seats, accessories, etc.) that helps you actually use the engine to move forward!  


### RStudio is the vehicle body  

"RStudio" is an interface (IDE) for easier use of R. It is offered for free by the RStudio corporation.  

Again, you can think of **R as the engine of a vehicle**, doing the crucial work, and **RStudio as the body of the vehicle** (with seats, accessories, etc.) that helps you actually use the engine to move forward! Therefore, you should install R *and* RStudio to proceed.  

When you open RStudio, it will automatically find the R installation on your computer, and use it. There is no need to open both programs.  



### Quiz  

Now, please check your understanding of R and RStudio by answering the questions below:  

```{r rstudio-quiz, echo=FALSE}
quiz(caption = "Quiz - R and RStudio",
    
   question("What is RStudio?",
            allow_retry = TRUE,
    answer("An application that makes it easier to use R.",
           correct = TRUE,
           message = "RStudio is an 'Integrated Development Environment (IDE) that makes it easier to write, use, debug, and save R code."),
    answer("A spreadsheet program like Microsoft Excel."),
    answer("Another name for R",
           message = "R and RStudio are two separate things. R is a language, like English or French. RStudio can be thought of as a program that helps you use the language, like how a word processing program helps you write."),
    answer("An application that lets you use R without writing any code",
           message = "You still have to write code - and that's a good thing! Code provides a reproducible record of your work, which is best practice.")
  ),
     
  
  question("Is RStudio free to download and use?",
    answer("Yes",
           correct = TRUE,
           message = "The RStudio IDE is a software offered for free by the RStudio corporation. There are other, less common, IDEs to use R, such as Tinn-R and Emacs."),
    answer("No",
           message = "RStudio IDE is free and open-source.")
  ),
  
  question("Do you need to install both R and RStudio?",
    answer("Yes.",
           correct = TRUE, message = "While it is possible to work in R without an interface like RStudio, this is not recommended for beginners."),
    answer("No.",
           message = "You need to install both programs separately.")
  ),
  
  question("Once both programs are installed, which one should you open to begin working?",
    answer("RStudio",
           correct = TRUE,
           message = "Opening RStudio will automatically start R."),
    answer("R",
           message = "For beginners, it is best to work in R *through* RStudio. Open RStudio."))
)
```




## RStudio tour 

`r fontawesome::fa("eye", fill = "darkblue")` Look around RStudio. If the size of the script is too small or large, adjust it in the *View* menu.  

* Observe the major RStudio panes. How many panes do you see?  
     * You should see at least 3 panes:  
        * The **Console, Terminal, Render, and Jobs** pane (left or lower-left)  
        * The **Environment** (upper-right, which also holds the **Tutorials** that this exercise is in)  
        * The **Files, Plots, Packages, Help, and Viewer** panes (lower-right)   
     * If you see only these 3 panes, click *File -> New file -> R script* to open a new R Script and achieve the classic look pictured below. Now you will have the 4th pane, which is called the "Source" pane.  
     * Take a few minutes to familiarize yourself with the locations of the various panes, using the diagram below.  
     
```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics("images/RStudio-overview.png")
```

**The Source Pane**
This pane, by default in the upper-left, is a space to edit, run, and save your scripts. Scripts contain the commands you want to run. This pane can also display datasets (data frames) for viewing.

For Stata users, this pane is similar to your Do-file and Data Editor windows.

**The R Console Pane**

In the lower-left, you may need to click from "Jobs" tab to the "Console" tab to see the R Console (because this tutorial is running). This is the home of the R software itself, the “engine” where the commands are actually run and non-graphic outputs and error/warning messages appear. You can directly enter and run commands in the R Console, but realize that these commands are not saved as they are when running commands from a script.

If you are familiar with Stata, the R Console is like the Command Window and also the Results Window.

**The Environment Pane**
This pane, by default in the upper-right, is most often used to see brief summaries of objects in the R Environment in the current session. These objects could include imported, modified, or created datasets, parameters you have defined (e.g. a specific epi week for the analysis), or vectors or lists you have defined during analysis (e.g. names of regions). You can click on the arrow next to a data frame name to see its variables.

In Stata, this is most similar to the Variables Manager window.

This pane also contains History where you can see commands that you can previously. It also has a “Tutorial” tab where you can complete interactive R tutorials if you have the learnr package installed. It also has a “Connections” pane for external connections, and can have a “Git” pane if you choose to interface with Github.

**Files, Plots, Packages, Help and Viewer Pane**
The lower-right pane includes several important tabs. The Files pane is a browser which can be used to open, rename, or delete files. Typical plot graphics including maps will display in the Plot pane. Interactive or HTML outputs will display in the Viewer pane. The Help pane can display documentation and help files. The Packages pane allows you to see, install, update, delete, load/unload R packages, and see which version of the package you have. To learn more about packages see the packages section below.

This pane contains the Stata equivalents of the Plots Manager and Project Manager windows.

`r fontawesome::fa("pen", fill = "brown")`  
For more detail on RStudio capabilities, download this PDF [RStudio IDE cheatsheet](https://raw.githubusercontent.com/rstudio/cheatsheets/main/rstudio-ide.pdf).  

<!-- TODO (gif) -->








## RStudio projects

### What is an RStudio project?  

Most of the time when you use R, it will make your life drastically easier to organize your work within an RStudio project.  

#### A self-contained and portable R environment  

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics("images/project_briefcase.png")
```


An RStudio project is a **self-contained and portable R working environment** - effectively a folder for all the files associated with a distinct project (data files, R scripts, outputs, etc.).  

* You can zip an RStudio project and email it to someone else. They should be able to open it and replicate your work exactly!  
* An RStudio project can be linked to a repository on version-control software like Git/Github  

If you do not work in an R project, it will be harder to organize files, to share your work with others, and you may encounter lots of frustration struggling to import files with something called the "working directory". When you use an R project, your scripts become much more easy to share and less likely to "break" when someone else uses them.  

#### Confirm that you are in a project  

If you are working in an RStudio project, you will see the name of the project indicated in the upper-right corner of RStudio. If you are not in an RStudio project, it will read "Project: (None)". **What do you see in your RStudio?**  

```{r, eval = TRUE, echo = FALSE, out.width = "75%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics("images/Rproject_dropdown.png")
```


## Explore your RStudio project  

Now we will practice opening your RStudio project.  

Navigate to the "intro_course" folder that you saved on your desktop, where you saved the R project.  

The contents of the folder should look similar to this:  

```{r, eval = TRUE, echo = FALSE, out.width = "75%"}
knitr::include_graphics("images/new_r_project_explorer.png")
```

In the folder, you should see a small file with an icon that looks like an "R box" - this is the RStudio project file (.Rproj).  

**To directly open the project next time, simply double-click this RStudio project file to open it. RStudio will open, and all your files for this project will be at-the-ready.**  


`r fontawesome::fa("eye", fill = "darkblue")`
Observe in the "Files" RStudio pane (lower-right) that you can also see and access the contents of the "intro_course" project.  


```{r, eval = TRUE, echo = FALSE, out.width = "75%"}
knitr::include_graphics("images/new_r_project.png")
```

You can read more about RStudio projects in [this chapter of the Epi R Handbook](https://epirhandbook.com/en/r-projects.html).  





## Running R commands

### Open an R script

**If you have not already done so, open a new R script** by clicking *File -> New file -> R script*. 

```{r script-new, fig.margin = TRUE, echo = FALSE, fig.width = 3, out.width = "35%", fig.cap = ""}
knitr::include_graphics("images/new_script.jpg")
```

You should see a new empty space appear in the upper-left of RStudio. This space is the R script.  

Currently, the script is not saved. Click the save icon above the script, or click *File -> Save As*.  

**Name the script as "demo.R" and ensure it saves in the same folder as your R project**.  

Note that the file extension for an R script is ".R". In working with R, you will encounter other extensions, but remember that this one is for R scripts.  

`r fontawesome::fa("eye", fill = "darkblue")` Observe that the file now appears in the "Files" RStudio pane in the lower-right. Similarly, it should also appear in your File Explorer.    


```{r file-quiz, echo=F}
quiz(
  question("Which of these file names is an R script?",
           allow_retry = TRUE,
    answer("survey_analysis.Rproj", message = "No, this extension signifies an R project. You could click this to open RStudio and work on the project."),
    answer(".Rhistory", message = "No, .Rhistory is a special file that saves a record of commands and outputs. It is rarely viewed."),
    answer("cholera_plots.Rmd", message = ".Rmd signifies an 'R markdown' script, which is not a standard R script. You'll learn about R markdown later in the course."),
    answer("measles.R", correct = TRUE, message = "Yes, the .R signifies that this is an R script.")
  )
)
```


### A script is a list of instructions for R  

A script is a place to write instructions for R. 

A typical R script for public health analysis/reporting might include sections like:  

* Header containing information for the reader such as the script objective, authors, contact info, date last updated, etc.
* Load R packages
* Load the data
* Clean the data
* Perform summary and statistical analyses
* Display results as plots, tables, maps, etc.

In the example below, the green text and hash (#) symbols are "comments" or "notes" for the reader, or used to delineate sections of the script. The black and blue text is R code commands.  

```{r script-example, fig.margin = TRUE, echo = FALSE, fig.width = 3, out.width = "85%", fig.cap = ""}
knitr::include_graphics("images/example_script.png")
```



### Write simple R commands  

`r fontawesome::fa("terminal", fill = "black")` Let's do some coding!

#### Get comfortable writing and running commands

As described in the class demonstration, you can run R commands the following ways:  

1) Type the command directly into the *Console pane* (lower-left of RStudio) and press Enter.  
2) Type the command into a script, ensure that your cursor on this line of the script, and press the "Run" button in the upper-right of the script.  
3) Type the command into a script, ensure that your cursor is on this line of the script, and type Ctrl and Enter (or Cmd and Enter on a Mac).  
4) Use your mouse to highlight certain part of a command. Press "Run" or Ctrl+Enter to run only the highlighted code.   


#### R as a calculator  

**Let's begin with perhaps the most simple use of R, just to get comfortable running commands.**  

Below are common mathematical operators in R. These are often used to perform addition, division, to create new columns in datasets, etc. Spaces around the operators will not affect the command, but make the code more readable.

| Purpose             | Example in R |
|---------------------|--------------|
| addition            | 2 + 3        |
| subtraction         | 2 - 3        |
| multiplication      | 2 \* 3       |
| division            | 30 / 5       |
| exponent            | 2\^3         |
| order of operations | ( )          |


**Type simple mathematical commands into the R script. Try to run the commands in ALL of the ways listed above.**  

**Which is your preferred method to run a command?**  

For these simple commands (that do not involve saving any objects nor graphical outputs), the result will appear in the Console pane.  

**Now, run commands in your R script to find the solutions to these math problems:**  

```{r quiz-math, echo = FALSE}
quiz(caption = "R as a calculator",
  question_numeric(
    "What is the sum of 12, -99, 2, 147, and 29?",
    answer(91, message = "Excellent!", correct = T),
    allow_retry = TRUE,
    correct = "Correct, nice work.",
    min = 1,
    max = 3000,
    step = 1
  )
)
```



<!--
NOTE: Below is the hint (all within details tags collapsed)
-->
<details>

<summary style='text-decoration: underline; color: darkgreen;'>`r fontawesome::fa("lightbulb", fill = "gold")` Click to read a hint</summary>
</br>

Use the addition operator `+` between the numbers, place the cursor on that line of the script, and press the "Run" button in the upper-right of the script. Don't forget that the second value is NEGATIVE 99.    

</br>
</details>

<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
12 + -99 + 2 + 147 + 29
```

</br>
</details>
<!--
NOTE: End of solution
-->

</br>

Let's try a question more relevant to public health:  

You are managing a COVID testing campaign across 3 sites, and you need to place a supply purchase order for rapid tests for next month. Based on the following information, how many tests do you need to order?  

* Site 1 uses 200 per month  
* Site 2 uses 550 per month  
* Site 3 has 2 sub-sites that each need 925 tests per month  
* You should order 10% extra as a buffer against higher demand  
* You have 420 tests extra remaining from last month, which you can use in the coming month  

```{r quiz-math2, echo = FALSE}
quiz(caption = "Supply chain exercise",
  question_numeric(
    "How many tests should you order for the coming month?",
    answer(2440, correct = T),
    allow_retry = TRUE,
    correct = "Correct, nice work.",
    incorrect = "Try again, or view the hints below. Think about order of operations...",
    min = 1,
    max = 3000,
    step = 1
  ),
  question(
    "Where in RStudio was the answer printed?",
    allow_retry = TRUE,
    answer("The R Console, in the lower-left", correct = TRUE),
    answer("The Plots pane, in the lower-right", message = "No it was not printed to the Plots pane. Check the Console in the lower-left."),
    answer("In the R Script", message = "No, it was not printed in the R Script. Look below at the Console pane.")
  )
)
```



<!--
NOTE: Below is the hint (all within details tags collapsed)
-->
<details>

<summary style='text-decoration: underline; color: darkgreen;'>`r fontawesome::fa("lightbulb", fill = "gold")` Click to read a hint</summary>
</br>

Use parentheses ( ), the asterisk multiplication operator, and the addition + and subtraction - operators. First, total the known needs (200, 550, and two times 925). Wrap that all in parentheses, because you need to multiply that sum by the desired buffer (110%, but in decimal form). That total should also be wrapped in parentheses, because you need to then subtract the extra left-over from the previous month (which does not need to be purchased).  

</br>
</details>

<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
# COVID-19 test monthly order calculcations
###########################################

# Site 1 uses 200 per month  
# Site 2 uses 550 per month  
# Site 3 has 2 sub-sites that each need 925 tests per month  
# Order 10% extra as a buffer against higher demand  
# At the end, subtract the number of tests remaining from last month  

((200 + 550 + (925 * 2)) * 1.1) - 420

```

</br>
</details>
<!--
NOTE: End of solution
-->

`r fontawesome::fa("pen", fill = "brown")` It is important to write your code so that other people have an easy time reading it! In fact, if you return to this code one or two months later, you may need help remembering why you wrote this command. 

As described in the class demonstration, any text written to the right of a "hash" symbol (#) is ignored by R as it runs commands in a script. So, you can use these symbols to write "comments" throughout the script. 

Make sure that your solution has the following:  

- A header that describes the purpose of the command  
- Some detailed instructions about the command  
- **Spaces** around all the operators as you would in writing English or another language.   

See the solution above for proper form. Future readers of your code will thank you!  








## Creating objects  

### Types of objects  

R is built to allow you to store "*objects*" for later use. They are stored in your R **Environment**, which is visible in the Environment pane of RStudio (upper-right).  

Everything you store in R - datasets, variables, a list of village names, a total population number, even outputs such as graphs - are **objects** which are **assigned a name** and **can be referenced** in later commands.

In a given work session you may create ("define") and re-define hundreds of objects. Some examples of objects include:  
     
* Single values, for examples: 
     * Numeric (e.g. 2)
     * Logical (TRUE or FALSE)  
     * Character (e.g. "Kigali")  
* A "data frame" (a dataset imported into R from an Excel, CSV, or other file format)
* A "vector" (combined sequence), of single values  
     
We'll talk more about the various types of objects later, but for now let's practice defining simple object that are single values. 



### The assignment operator  

**Create objects by assigning them a value with the "assignment operator", that is: `<-`**  

You can think of the assignment operator <- as the words “is defined as”. This operator looks like an arrow, and it takes the **value** of the right side, and assigns it to the **name** on the left. Assignment commands generally follow a standard order:

>**object_name <- value** (or calculation/process that produces a value)

By running the command with the assignment operator, you can **create** an object, or by re-running the command you can **re-define** the object with a new value.  

#### R Environment  

`r fontawesome::fa("eye", fill = "darkblue")` Click to look at your "Environment" pane in RStudio. This is a sub-panel in the same pane that the exercise is running in. Right now, there should be no entries in the Environment pane, because we have not defined any objects yet.  

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics("images/empty_environment.png")
```


**Now, write the code below in your R script, and run the command.** (yes, please type it, not just copy/paste, to get familiar with typing the R commands!)  

```{r, echo=TRUE, eval=F}
confirmed_cases <- 34
```

We have created the object `confirmed_cases`, and assigned it the value `34`. This means that in our script (or in the R Console) we can run other commands using the name `confirmed_cases`, and R will know that we are refering to the value 34.  

`r fontawesome::fa("eye", fill = "darkblue")` **Look in your Environment pane now**.  


```{r, quiz-assign, echo=F}
quiz(
   question_checkbox("When you ran the command above to define an object, what happened in RStudio (select ALL that are correct)?",
    answer("A new stored object appeared in the Environment pane, named 'confirmed_cases', with a value of 34",
           correct = TRUE,
           message = ""),
    answer("The command that was run appeared in the Console (lower-left) pane",
           correct = TRUE,
           message = "Note that only the command appeared as run, not any calcuated output"),
    answer("34 appeared in the Console as calculated output",
           message = "This command simply assigns a value to a object name, it does not ask R to print the result of any calculation"),
    allow_retry = TRUE
  )
)
```


`r fontawesome::fa("pen", fill = "brown")`
A quick note about naming objects:  

* **Object names must not contain spaces**, but you should use underscore (_) or a period (.) instead of a space.
* **Object names are case-sensitive** (meaning that Dataset_A is different from dataset_A).
* **Object names must begin with a letter** (cannot begin with a number like 1, 2 or 3).  
* Typically, coders write object names in all lowercase, but this is a stylistic choice  
* Keep you object names short - it is much easier to code with short names  

`r emo::ji("cross mark")` `my object name`  
`r emo::ji("cross mark")` `dataset` and `Dataset`  
`r emo::ji("cross mark")` `2nd_wave_of_cases_from_Santa_Clara_County`  

`r emo::ji("check")` `cases_zambia`  
`r emo::ji("check")` `linelist_raw`
`r emo::ji("check")` `lab_20140216`  

Note: in R literature, you may often see people using `df` as an object name. This is a very shorthand way to refer to the fact that the object they are saving is a "data frame" (dataset with columns and rows).  


`r fontawesome::fa("terminal", fill = "black")` 
Back to your R script... you can now return/print the *value* assigned to the name `confirmed_cases`, by simply running the name as a command **(look at the R console pane for the output)**:  

```{r, echo=TRUE, eval=FALSE}
confirmed_cases
```

**Now, using the same approach, define an object named `suspect_cases` and assign the value `12`.**  


<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
suspect_cases <- 12
```

</br>
</details>
<!--
NOTE: End of solution
-->


**Then, write and run the following command.** See how you can now reference the values by calling only the assigned names.   

```{r, echo=TRUE, eval=F}
total_cases <- confirmed_cases + suspect_cases
```

```{r, quiz-case-math, echo=F}
quiz(
   question("What is the number of total cases?",
    answer("34",
           message = "You have selected the number of CONFIRMED cases only"),
    answer("12",
           message = "You have selected the number of SUSPECT cases only"),
    answer("46",
           correct = TRUE,
           message = "You have successfully selected the total number of cases"),
    allow_retry = TRUE
  )
)
```

### Re-defining objects  

What happens if you receive news that there are 10 additional confirmed cases?  If you edit the first command to read `confirmed_cases <- 44`, does the value of `confirmed_cases` in the RStudio Environment pane immediately change to 44? (no) Does the value of `total_cases` immediately change to `56`?  

```{r, quiz-case2-math, echo=F}
quiz(
   question_checkbox("Which steps must happen for total_cases to be updated to 56?",
    answer("Run the command: confirmed_cases <- 44",
           message = "Yes, first the confirmed_cases must be re-defined",
    correct = T),
    answer("Run the command: total_cases <- confirmed_cases + suspect_cases",
           message = "Yes, second, the total must be updated with the new number of confirmed cases",
    correct = T),
    answer("Give your course instructor a gift",
           message = "No, bribing your course instructor will not make R do magic."),
    allow_retry = TRUE
  )
)
```

If you change a written value in your script, it does **not automatically update** the rest of your script, nor does it change any values stored in R!  
**You must re-run the commands** in order for the changes to be registered by R.  

In this case, you must re-run two commands to update the value of `total_cases` (and they must be run in the correct order!)  

### Running your whole script  

At this point, you might wonder - "why do I need to run each line of my script one-by-one?". Well, you don't have to! You have two options to run multiple commands at once:  
1) Use your mouse to highlight both commands in the script, and run  
2) If you want to run ALL the commands in your script, from top-to-bottom, select all the commands by pressing Ctrl + a (Cmd + a for Mac), and click "Run"  


Before you run the entire script, consider whether you have any unfinished code above your current selection that might cause an Error. Remember, you are asking R to run *every command in the entire script*, and R will stop if it encounters an error.   

If there is one command you want to temporarily remove, place a # symbol at the beginning of this line to the left of the code. R will ignore this line. 




### Exercise: Medical supply chain calculation  

`r fontawesome::fa("terminal", fill = "black")` 
Let's run an exercise that uses that supply chain example from the previous section. As a reminder: you are managing a COVID testing campaign across 3 sites, and you need to place a supply order for rapid tests for next month. You have the following information:  

* Site 1 uses 200 per month  
* Site 2 uses 550 per month  
* Site 3 has 2 sub-sites that each need 925 tests per month  
* You should order 10% extra as a buffer against higher demand  
* You have 420 tests extra remaining from last month, which you can use in the coming month  

You wrote this command to return the need for tests next month:  

```{r eval = F, echo=T}
((200+550+(925*2))*1.1)-420
```

**Re-write this script so that is easy to re-run every month**, and so that it will produce the number of tests you need to order for the next month. 



<!--
NOTE: Below is the hint (all within details tags collapsed)
-->
<details>

<summary style='text-decoration: underline; color: darkgreen;'>`r fontawesome::fa("lightbulb", fill = "gold")` Click to read a hint</summary>
</br>

Begin by writing 3 commands, which define the needs for each of the 3 sites. Then, write one command that defines excess tests remaining from the previous month. Finally, write a command that prints the total number of tests needed by replacing the numbers with the object names defined in the previous commands.    

</br>
</details>

<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
site1 <- 200
site2 <- 550
site3 <- 925 * 2
extra <- 420

((site1 + site2 + site3)*1.1) - extra
```

</br>
</details>
<!--
NOTE: End of solution
-->


</br>


```{r, quiz-tests-math, echo=F}
quiz(
   question_checkbox("How many tests should you order if site 1 needs 250, site 2 needs 730, site 3's two sites need 1050 each, and you have 37 extra from the previous month?",
    answer("3253",
           message = "Check your parentheses - is 1.1 multiplied on ALL of the sites, as it should be?"),
    answer("3351",
           correct = TRUE,
           message = "Nice work!"),
    answer("2980",
           message = "You have made an incorrect calculation, check your code against the solution"),
    allow_retry = TRUE
  )
)
```

`r fontawesome::fa("pen", fill = "brown")`
For extra credit, answer the following two questions:  

* If you wanted to save the final output value to reference later, what operator would you add, and where?  
* How would you need to modify your script if the two sub-sites of site 3 needed different numbers of tests?  

`r fontawesome::fa("exclamation", fill = "red")` 
Remember to save your R script often! Just click the small "save icon" in the row of icons above the script, or click *File -> Save*  

### Commenting  

You have now written a useful script! But what if your colleague wants to use it? Will they be able to understand your logic and commands?  
As before, use the `#` symbol to add "comments" into the script that clearly explain what is occurring.  

As described in the class demonstration, any text written to the right of the comments is ignored by R as it runs commands. So, you can place a hash symbol at the beginning of a line, or you can place the comment after some code (to write a comment on the same line as code).  

Here is a picture of a simple R script that has good commenting:  


```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics("images/example_script.png")
```


Now you try!  


<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
# Testing supply order script
# Objective: to calculate the amount of tests we need to order for next month
# Author: (name here)
# Last update: 5 March 2022


# Monthly inputs
################
# You can change these numbers to reflect the expected needs for each site
site1 <- 200         # needs for site 1
site2 <- 550         # needs for site 2 
site3 <- 925 * 2     # needs at each sub-site of site 3 (it is multiplied by 2)
extra <- 420         # the number of tests remaining from last month


# Calculation
#############
# Note: This equation includes a 10% buffer, via the 1.1 factor

((site1 + site2 + site3)*1.1) - extra

```

</br>
</details>
<!--
NOTE: End of solution
-->



### Character objects  

Defined objects can also be "character", meaning letters and symbols that are not numbers. Character values are distinguished by being placed within quotation marks, like "New York City" or "dm76wk34" (a randomly-generated case unique identifier). Note that the quotations can be double quotes like "exposed" or can be single quotes like 'infected' - these have the same effect.  

Note that thirty-four could be written in R as:  

* `34` (a numeric value, capable of being used in mathematic calculations), or  
* "34" (a character value, not capable of calculations)  
     
When your R script recognizes that something you have written is a character value (once the first and last quote marks are written) it will turn a different color. See below.  

Try to define some character objects in your script, like the ones below. Experiment with printing them to the Console, and with changing their value. What happens if you try to add `30` + "12"?  

```{r, echo=T}
name <- "Oliver"
district <- "Bolo"
occupation <- "nurse"
```







## Functions  

The previous exercises have been relatively simple coding. We used mathematical operators to perform calculations. But this is not really showcasing R's abilities! Those exercises were simply to have you practice running commands and creating simple objects.  

**The real power of R comes from *functions***. Functions are at the core of using R. Functions are how you perform tasks and operations.  

### A function is like a machine  

A function receives inputs, does some action with those inputs, and produces an output. What the output is depends on the function.  


### Simple functions  

Functions typically operate upon an object placed within the function’s parentheses. For example, the function `sqrt()` returns the square root of a number:

```{r, echo=T}
sqrt(64)
```

Likewise, the function `sum()` accepts an unlimited number of numeric values and returns the sum. 

```{r, echo=T}
sum(2, 5, 10, -8, 100)
```

`r fontawesome::fa("terminal", fill = "black")` Time for you to practice this coding in RStudio! In your R script (named "demo.R"), use the function `min()` and `max()` to find the minimum and maximum of the numbers 3, 55, 9, -4, and 33.  

We won't do a quiz, because the answers should be quite easy... but did your code work?  

```{r, echo=T}
# calculate the minimum value
min(3, 55, 9, -4, 33)

# calculate the maximum value
max(3, 55, 9, -4, 33)
```




### Vectors  

Try the function `c()`. What does that function do? The "c" represents the term "concatenate", because this function combines the values within its parentheses into one unit.

We call this unit a **vector**. A vector is a unit of several values, *which must be of the same class* (either all numeric, all character, all logical, etc.) and *must be separated by commas*.   

Vectors may seem abstract right now, but will be useful in later modules of this course. For example, you may need to create a vector of column names that will be printed in a table, or a vector of colors to use in a plot.  

See this example, where we create a named vector of numeric values (the ages of 5 patients).  

```{r, echo=T}
# create a vector of patient ages
patient_ages <- c(5, 10, 60, 25, 12)
```

Try the above command in your R script. Now, what happens when you run the command `patient_ages`? All the numbers appear in the R Console.  

It is useful that these numbers can be referenced by one name, because now we can apply changes to all of them with just one step:  

```{r, echo=T}
patient_ages * 2
```

Now, I'm not sure why we would need to multiply all the patient ages by 2, but it sure was easy, wasn't it?!

Try creating your own vector - make a vector of some names of districts/cities/counties in your home region. Name it `jurisdictions`. Does your command look similar to this?  

```{r, echo = T}
# A character vector of jurisdiction names in Mozambique  
jurisdictions <- c("Maputo", "Inhambane", "Gaza", "Zambezia", "Manica", "Sofala")
```

What can we do with a character vector? We cannot multiply it by 2... for fun, let us **put this vector in another function**: `toupper()`, which changes all of the characters to upper case:  

```{r, echo=T, eval=F}
toupper(jurisdictions)
```

Note: Even though the vector contains character values, when typing the *name* of the vector, you do not use quotes. It is an R object just like `confirmed_cases`, and so should be written plainly in code.  

**What does the output look like?** What if you try the function `tolower()`? This could be useful to standardize names or other character words when joining two datasets!  








### Functions with named arguments  

Most functions you will encounter in R have *named arguments*, which means you need to specify the settings under which the function will operate.  

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics("images/arguments-buttons.png")
```


Let's return to the character vector `jurisdictions` that you defined earlier. We will use the names from the example, but your vector may include other jurisdictions local to your home region.  

Imagine you have this vector of jurisdiction names, but when you run `jurisdictions` in R to print the list of jurisdictions, it looks ugly and is not very readable.  

```{r, echo=T}
jurisdictions
```

You know that R has the ability to make automated reports (which you will learn later in this course). It is very possible that you will want to combine these jurisdiction names in a way that they can be printed in a report - with commas between them for proper punctuation.

The function `paste()` will accept a vector of multiple character values, and combine them into **one** character value. Even better, with your help it will insert some characters *in between* each of the old values (e.g. a space, or a comma, or both!).  

The function `paste()` has an **argument** that is named `collapse`.  

Arguments are written *within the parentheses with a single equals sign*, so we will refer to this argument as `collapse = `. If there are multiple arguments for one function, they are written with commas between them. See the result:  

```{r, echo = T}
paste(jurisdictions, collapse = ",")
```

Let's understand what is going on:  

```{r, results = "asis", echo = FALSE}
"The first argument expects the name of a vector, in this case: jurisdictions" %>%
  flair::flair("jurisdictions", color = "deeppink") %>%
  flair::flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

Often, the first argument of a function is data to be operated upon, and does not require a name nor an equals sign.  

```{r, results = "asis", echo = FALSE}
"The second argument is collapse =, to which we provide a character value to appear between each of the words." %>%
  flair::flair("collapse =", color = "orange") %>%
  flair::flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

In the example above, we have chosen ", " which is a comma. The quotation marks ensure that R understands that this is a character value.  

```{r arguments, include = F}
paste(jurisdictions, collapse = ",")
```

```{r arguments_flair, echo = FALSE}
flair::decorate("arguments") %>%
  flair::flair("jurisdictions", color = "deeppink") %>% 
  flair::flair("', '", color = "orange") %>% 
  flair::flair("collapse", color = "orange") %>% 
  flair::knit_print.with_flair()
```

`r fontawesome::fa("terminal", fill = "black")` 
Replicate the code above with your `jurisdictions` vector in RStudio. 

**How would you adjust the code to add a space after each comma?**


<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
# Note the space after the comma, within the quotation marks
paste(jurisdictions, collapse = ", ")
```

</br>
</details>
<!--
NOTE: End of solution
-->


#### Optional arguments  

Often, functions have many arguments... you must become familiar with each function in order to know what it expects. Don't worry! R coders do not have encyclopedic brains - we look up this information all the time while coding.  

Thankfully, most arguements in a function have **default values**.  

For example, functions that make plots may be able to be adjusted in dozens of ways (`title = `, `subtitle = `, `color = `, etc.). But most of these arguments have **default values**, meaning that *you do not need to supply a value to that argument* for the function to successfully run. Instead, you can write the argument and its assigned value *if you wish*.  

#### Getting help  

A function's arguments and any default values can be read in the function's *documentation*. To read the documentation, search the name of the function in the **Help pane** in the lower-right of RStudio. Alternatively, type `?` before the function name in the RStudio **Console** pane (for example, `?paste`).  

The documentation details will look something like this (we can help you interpret, as they can be difficult to understand at first):  

```{r, fig.margin = TRUE, echo = FALSE, fig.width = 3, out.width = "60%", fig.cap = ""}
knitr::include_graphics("images/r-help.png")
```



```{r quiz-args-identify}
quiz(
  question("what are the arguments in the following command:\n\nage_pyramid(data = linelist, split_by = 'gender', age_group = 'agecat5', proportional = TRUE)",
    answer("linelist, split_by, age_group, proportional", message = "Careful! linelist comes after an equals sign. It is the value assigned to the argument data = "),
    answer("data, split_by, age_group, proportional", correct = T),
    answer("age_pyramid, linelist, 'gender', proportional", message = "age_pyramid is the function, and linelist is the value assigned to the argument data = "),
    allow_retry = T
  )
  )
```


```{r quiz-args-required}
quiz(
  question("All R functions have multiple arguments that require input",
    allow_retry = T,
    answer("True"),
    answer("False", correct = TRUE, message = "Not all functions have multiple arguments, and typically for functions with multiple arguments, many have default values that do not need to by supplied.")
  )
)
```








### Creating functions  

The magic of R really happens when you **create your own functions**. This is an advanced skill that we do not cover in this course, and you do not typically need to create functions until you are a more experienced R user. You do not need to try this code, unless you want to. This is purely background information.  

However, this aspect of R is where its versatility really begins to shine. Imagine if you could convert your entire workflow into one command?

For demonstration purposes, below, the testing supply chain script from the previous section is converted into a function:  

```{r, echo=T}
# create a function that accepts 4 inputs (1 is optional) and returns the 
# needs, based on the equation  

# create the function calc_test()
calc_tests <- function(site1, site2, site3, extra){   # list the arguments, and open the function
     
     needs <- ((site1 + site2 + site3)*1.1) - extra   # We embed the equation inside the function
     return(needs)                                    # the function returns the result
}                                                     # close the function

```

Once the above code is run, the function is defined (it will appear in the R environment pane just like the other objects).  

Now that the function has been defined, we can use it to run the equation given values for the arguments, like this:  

```{r, echo=T}
calc_tests(site1 = 200, site2 = 550, site3 = (925*2), extra = 420)
```

See how we've wrapped up all the code into a function! Very cool. Think of the possibilities...

If you write a function that is useful to others, you can publish it in an **R package** - a unit of multiple related functions. Everyone else can test and try your functions, and your work can help people around the world! ***This is the beauty of open-source software***.  




## Packages

Until now, you have used R functions that come installed with R. For example, `sum()`, `c()`, and `min()`.  

These are called **base R** functions, and they represent a very small portion of all R functions available to you.  

An **R package** is a shareable bundle of related functions that you can download and use. Packages typically have a theme, for example:  

* The **stringr** package provides functions for working with "strings" (character values)  
* The **lubridate** package provides functions that make it easier to work with dates  
* The **epikit** package provides functions useful in epidemiological analysis  

You can see that the names of packages are often clever puns - the fun spirit of the R community is evident.  



### CRAN  

**To install most R packages, use R commands to download the package from "CRAN" to your computer's "R library".**

Many R users create specialized functions, which they share in packages with the R community to verify.  

For packages to be widely distributed, they must be shared on the **Comprehensive R Archive Network (CRAN)**, which is R's central software repository - an archive of R packages that have passed basic scrutiny.  

As of March 2022, there are 19,020 packages available on CRAN. Some of these are immensely popular, with hundreds of thousands of downloads each month. 



### Security  

Are you worried about viruses and security when downloading a package from CRAN? Read [this article](https://support.rstudio.com/hc/en-us/articles/360042593974-R-and-R-Package-Security) on the topic.


### Install and load packages  

Once a package is **installed**, it is stored in **your R “library”**. You can then access the functions it contains by **“loading”** the package for use during your current R session .

Think of R as your personal library: *when you install a package, your library gains a new "book" of functions. But each time you want to use a function from that book, you must borrow (“load”) it from your library.*

```{r, fig.margin = TRUE, echo = FALSE, fig.width = 3, out.width = "50%", fig.cap = ""}
knitr::include_graphics("images/bookshelf1.png")
```

In summary: to use the functions available in an R package, 2 steps must be implemented:

1. The package must be installed (once), and
2. The package must be loaded (each R session)


#### Code for installing packages

Remember how we said there are **base R** functions? There is a **base R** function to install packages, and it is `install.packages()` (note that "packages" is written in plural).  

The name of the package to install must be provided in the parentheses and in quotes. If you want to install multiple packages in one command, they must be listed within a character vector `c()`. Note that package names are case sensitive.  

```{r packages-base, echo=T, eval=F}
# install a single package with base R
install.packages("tidyverse")

# install multiple packages with base R
install.packages(c("tidyverse", "rio", "here"))
```

`r fontawesome::fa("exclamation", fill = "red")` 
Note: this command installs a package, but does not load it for use in the current session.


`r fontawesome::fa("terminal", fill = "black")` **Now you try it: install the package "pacman".** If a pop-up window asks if you want to re-start R, say "No".  


<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
install.packages("pacman")
```

</br>
</details>
<!--
NOTE: End of solution
-->

#### Code for loading packages  

Do you remember how often you need load a package? Every time you start R. 

You can do this using the **base R** command `library()`.  

**Try this command in RStudio.**  

```{r, echo=T, eval = FALSE}
# Loads the package pacman for use in the current R session
library(pacman)
```


### pacman  

**We had you install the package "pacman" because it contains functions to make it easier to quickly install and load other functions**.  

Its name refers to "**pac**kage **man**ager", not the video game character.  

Can you imagine the potential complications caused when sharing R scripts with someone else? Do they have the same R packages that you have?  

You don't want them to have to search through the script to find which packages you used in the script... so should you write `install.packages()` commands at the top of the script? And then all of the `library()` commands as well? If you use 15 packages, that is a lot of lines... and potentially a lot of unnecessary installations...

One solution is **pacman**'s function `p_load()`. You can list the names of packages inside, and it will install each package *only if it is not already installed*. Additionally, it will load each package for use in the R session. It is a very efficient option - you can include it at the top of your script. If your colleague receives the script, as long as they have **pacman** already, the script will only install the packages they do not already have, and will load all of them for use.  

Here is what a **pacman** command can look like. The syntax is quite simple. Just list the names of the packages within the `p_load()` parentheses, separated by commas. Note that package names are case-sensitive.  

```{r, echo=T, eval=F}
pacman::p_load(rio, here, janitor, lubridate, tidyverse)
```

The syntax `pacman::p_load()` explicitly writes the package name (**pacman**) prior to the function name (`p_load()`), connected by two colons `::`. This syntax is useful because it also loads the **pacman** package (assuming it is already installed). 

This command can also be written vertically. **In any R command, the newlines and indenting will not impact the execution of the code.** But it can dramatically improve readability!  

```{r, echo=T, eval=F}
# Load all the packages needed, installing if necessary
pacman::p_load(
     rio,          # for importing data
     here,         # for file paths
     janitor,      # for data cleaning
     lubridate,    # for working with dates
     tidyverse     # for data management
)
```

 


```{r quiz-packages-install}
quiz(caption = "Quiz - packages",
  question("How often do you need to install a package on your computer?",
    allow_retry = T,
    answer("Every time you restart R", message = "Packages only need to be installed once. There is no relation to restarting R."),
    answer("Only once", correct = TRUE, message = "Packages must be installed once. After a long time, you may want to update them by re-installing."),
    answer("Never (assuming you are connected to the internet)", message = "Packages must be installed once. You can not access them dynamically through the internet."),
    answer("Each time you restart your computer", message = "Packages only need to be installed once. There is no relation to restarting your computer.")
  ),

  question("How often do you need to load a package?",
    allow_retry = T,
    answer("Every time you start or restart R", correct = TRUE, message = "Packages must be loaded each time you start an R session."),
    answer("Only once", message = "Packages must be installed only once, but must be loaded at the beginning of each R session."),
    answer("Never (assuming you are connected to the internet)", message = "Packages must be installed once and loaded at the beginning of each R session. You can not access them dynamically through the internet."),
    answer("Each time you restart your computer", message = "Packages only need to be installed once and loaded at the beginning of each R session. There is no relation to restarting your computer.")
  ),

  question("Newlines and indents can be used to improve readability without impacting code execution.",
    allow_retry = T,
    answer("True", correct = TRUE),
    answer("False")
  ),

  question("The pacman function p_load() does which of the following (select ALL that apply).",
    allow_retry = T,
    answer("Installs the packages if it is not yet installed", correct = TRUE),
    answer("Loads the packages for use", correct = TRUE),
    answer("Produces a small yellow pacman emoji that eats your code line-by-line")
  )
)
```





## Other operators

Now that you know more about functions and syntax, take a look through these other common operators and **base R** functions.  

Do not spend a lot of time reviewing these in this exercise, but skim them quickly. If you forget them, these can always be found in the Epi R Handbook [R Basics page](https://epirhandbook.com/en/r-basics.html#operators).  



### Relation operators  

Relational operators compare values and are often used when defining new variables and subsets of datasets. Here are the common relational operators in R:

+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Meaning                  | Operator   | Example      | Example Result                                                                                                                                         |
+==========================+============+==============+========================================================================================================================================================+
| Equal to                 | `==`       | `"A" == "a"` | `FALSE` (because R is case sensitive) *Note that == (double equals) is different from = (single equals), which acts like the assignment operator `<-`* |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Not equal to             | `!=`       | `2 != 0`     | `TRUE`                                                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Greater than             | `>`        | `4 > 2`      | `TRUE`                                                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Less than                | `<`        | `4 < 2`      | `FALSE`                                                                                                                                                |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Greater than or equal to | `>=`       | `6 >= 4`     | `TRUE`                                                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Less than or equal to    | `<=`       | `6 <= 4`     | `FALSE`                                                                                                                                                |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Value is missing         | `is.na()`  | `is.na(7)`   | `FALSE` (we will discuss missing data in R, later)                                                                                                                   |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Value is not missing     | `!is.na()` | `!is.na(7)`  | `TRUE`                                                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+

### Logical operators  

Logical operators, such as AND and OR, are often used to connect relational operators and create more complicated criteria. Complex statements might require parentheses ( ) for grouping and order of application.

+---------------------+-----------------------------------------------------------------------+
| Meaning             | Operator                                                              |
+=====================+=======================================================================+
| AND                 | `&`                                                                   |
+---------------------+-----------------------------------------------------------------------+
| OR                  | `|` (vertical bar)                                                    |
+---------------------+-----------------------------------------------------------------------+
| Parentheses         | `( )` Used to group criteria together and clarify order of operations |
+---------------------+-----------------------------------------------------------------------+


### `%in%`

A very useful operator for matching values, and for quickly assessing if a value is within a vector or dataframe.

```{r, echo=T}
my_vector <- c("a", "b", "c", "d")
```

```{r, echo=T}
"a" %in% my_vector
"h" %in% my_vector
```

To ask if a value is **not** `%in%` a vector, put an exclamation mark (!) **in front** of the logic statement:

```{r, echo=T}
# to negate, put an exclamation in front
!"a" %in% my_vector
!"h" %in% my_vector
```





### Base R math functions  

| Purpose            | Function                              |
|--------------------|---------------------------------------|
| rounding           | round(x, digits = n)                  |
| rounding           | janitor::round_half_up(x, digits = n) |
| ceiling (round up) | ceiling(x)                            |
| floor (round down) | floor(x)                              |
| absolute value     | abs(x)                                |
| square root        | sqrt(x)                               |
| exponent           | exponent(x)                           |
| natural logarithm  | log(x)                                |
| log base 10        | log10(x)                              |
| log base 2         | log2(x)                               |



Note: See [this page in the Epi R Handbook](https://epirhandbook.com/en/r-basics.html#rounding) before using rounding functions. There is some mathematical nuance that is important in some circumstances.  

### Statistical functions  

[***CAUTION:*** The functions below will, by default, include missing values in calculations. Missing values in the vector (which in R are written as `NA`) will result in an output of `NA`, unless the argument `na.rm = TRUE` is specified. Setting this argument to `TRUE` is specifying that **NA**s be **removed** (rm) from the calculation. This can be written shorthand as `na.rm = T`.  


| Objective               | Function           |
|-------------------------|--------------------|
| mean (average)          | mean(x, na.rm=T)   |
| median                  | median(x, na.rm=T) |
| standard deviation      | sd(x, na.rm=T)     |
| quantiles\*             | quantile(x, probs) |
| sum                     | sum(x, na.rm=T)    |
| minimum value           | min(x, na.rm=T)    |
| maximum value           | max(x, na.rm=T)    |
| range of numeric values | range(x, na.rm=T)  |
| summary\*\*             | summary(x)         |

Notes:

* `quantile()`: `x` is the vector of numbers to consider, and `probs =` is a numeric vector with probabilities within 0 and 1.0, e.g `c(0.5, 0.8, 0.85)`
** `summary()`: gives a summary on a numeric vector including mean, median, and common percentiles

[***DANGER:*** If providing a vector of numbers to one of the above functions, be sure to wrap the numbers within `c()` .]{style="color: red;"}

```{r, eval=T, echo=T}
# If supplying raw numbers to a function, wrap them in c()
mean(1, 6, 12, 10, 5, 0)    # !!! INCORRECT !!!  

mean(c(1, 6, 12, 10, 5, 0)) # CORRECT
```



## Project organization  


### File naming can impact your quality of life  

File naming can seem like a small thing to focus on, but the ramifications can be significant. Proper file naming can really save you time and headache, and switching your practice can be easy.  

Imagine the power of R - you can write code to automatically import the most recent data files by the date in their file name! But this can be hindered by poor file naming practices.  

Even if you never try coding such as that, you surely know that bad file naming practices can cause significant problems for version control and archiving.  

### Good and bad file names  

**Have you ever seen files like these?**  

`r emo::ji("cross mark")` notes.docx  
`r emo::ji("cross mark")` a.R  
`r emo::ji("cross mark")` 2b.xlsx  
`r emo::ji("cross mark")` notes.txt  

**How about something like this?**  

`r emo::ji("cross mark")` case control San Jose factory.pptx  
`r emo::ji("cross mark")` abstract for Mark?.xlsx  
`r emo::ji("cross mark")` December 20 update.R  
`r emo::ji("cross mark")` draft "malaria study" report(1).docs  

These are very difficult to work with. Try to follow these principles when naming files (your future self will thank you!):  

* **Be nice to machines**  
* **Be nice to humans**  
* **Make sorting and searching easy**  

Let's discuss tips to achieve each of these principles.  


### Names that are machine-readable  

**Don't use white (empty) space in file names** (machines sometimes get confused by spaces)  

`r emo::ji("cross mark")` Draft Vax outreach team.docx  
`r emo::ji("check")` vaccination-outreach_draft01.docx  
     

**Use letters, numbers, hyphens (-), and underscores (_) only** (special characters can have special meanings and confuse machines e.g. ^.*?+|$ )  

`r emo::ji("cross mark")` Ministry report ?.docx  
`r emo::ji("check")` ministry_report_draft01.docx  


**Never have two file names that differ only by case** (some operating systems treat b and B the same, while others treat them as different), and **be consistent with your case** (usually lowercase is better)  

`r emo::ji("cross mark")` study.docx  
`r emo::ji("cross mark")` Study.docx  
`r emo::ji("cross mark")` Belgium-and-france.docx  

`r emo::ji("check")` study.docx  
`r emo::ji("check")` belgium-and-france.docx  

### Names that are human-readable  

**Use hyphens and underscores differently**  

* Hyphen should mean: "different words, but part of the same idea"  
* Underscore should mean: "different idea"  
     
`r emo::ji("check")` 20200316_goma_linelist.xlsx  
`r emo::ji("check")` transmission-analysis_california_mmwr.docx  


### Names that sort easily  

Dates should be written as **YYYY-MM-DD** (the ISO 8601 standard). Usually, it is best to place the dates before other name components to preserve chronology.  

File names with this style of dates do not sort in chronological order!  

`r emo::ji("cross mark")` 1-April-2012_linelist.xlsx  
`r emo::ji("cross mark")` 1-Jan-2009_linelist.xlsx  
`r emo::ji("cross mark")` 1-Jan-2012_linelist.xlsx  
`r emo::ji("cross mark")` 12-Jan-2012_linelist.xlsx  
`r emo::ji("cross mark")` 2-Jan-2012_linelist.xlsx  
`r emo::ji("cross mark")` 31-Dec-2009_linelist.xlsx  

But this style does sort correctly!

`r emo::ji("check")` 2009-01-01_linelist.xlsx  
`r emo::ji("check")` 2009-12-01_linelist.xlsx  
`r emo::ji("check")` 2009-12-31_linelist.xlsx  
`r emo::ji("check")` 2012-01-01_linelist.xlsx  
`r emo::ji("check")` 2012-01-02_linelist.xlsx  
`r emo::ji("check")` 2012-04-01_linelist.xlsx  

**To order files without dates**, use numbers as prefixes (left pad with 0 so all numbers have the same length!)  

`r emo::ji("check")` 01_introduction.docx  
`r emo::ji("check")` 02_methods.docx  
`r emo::ji("check")` 03_analysis.docx  

... (more chapters)...  

`r emo::ji("check")` 19_appendix-04.docx  
`r emo::ji("check")` 20_appendix-05.docx  
`r emo::ji("check")` 21_appendix-06.docx  

In the end, file naming does not come with hard rules - it is a personal choice. However, certain choices can lead to more frustration, lost files, and coding headaches later.  


```{r quiz-file-names}
quiz(caption = "Quiz - file names",
  question("What is problematic about this file name (select ALL that apply):\n\nSARS.Exposure.listing 1stdraft 01032016.csv",
    allow_retry = T,
    answer("The date is incorrectly ordered", correct = T, message = "The date should be in YYYY-MM-DD format"),
    answer("It is actually for Measles, not SARS ", message = "You don't know that! This is an example :-)"),
    answer("It uses special characters", correct = T, message = "File names should avoid periods"),
    answer("It uses spaces", correct = T, message = "Avoid spaces in file names"),
    answer("The date should be at the beginning", correct = T, message = "For proper ordering, the date should be at the beginning")
  )
)
```

### Clean file names  

`r fontawesome::fa("window-restore", fill = "darkgrey")` In your File Explorer, view the "intro_course" folder that we gave to you at the beginning of the course, in which you have created the R project.  

Here is how your folder structure should look:  

* `r emo::ji("folder")` project ("intro_course")  
     * `r emo::ji("folder")` data
          * `r emo::ji("folder")` clean  
          * `r emo::ji("folder")` raw  
          * `r emo::ji("folder")`pop  
          * `r emo::ji("folder")` shp  
     * `r emo::ji("folder")` scripts
     * `r emo::ji("folder")` outputs  
     * `r emo::ji("folder")` learning materials  
          * `r emo::ji("folder")` slides
          * `r emo::ji("folder")` covid_case_study  
     * `r emo::ji("document")` surveillance_linelist_20141201.csv
     * intro_course.Rproj  

`r emo::ji("warning")` You may also have some other files like ".Rhistory" - do NOT delete these. Just leave them.  


#### Clean file names  

`r fontawesome::fa("window-restore", fill = "darkgrey")` **Now enter the folder "data/raw/hospital".**  

Regard the files - these are linelists of Ebola patients admitted for care, as sent to you on the 1st of December 2014, from 4 different hospitals (**Port Hospital**, **Military Hospital**, **St. Mark's Maternity Hospital (SMMH)**, and **Central Hospital**). There are also files containing records from **"Other" hospitals**, and of patients for whom the **hospital is "Missing"**.  

How can these file names be improved? Both for human readability, but also to facilitate standardized code that we may write to import them into R?  

**Edit the file names to that they are standardized with best practices above**  

**When finished, view a "solution" below.** We suggest that you align your file names with these.  

<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

* 20141201_hosp_central.csv  
* 20141201_hosp_military.csv  
* 20141201_hosp_port.csv  
* 20141201_hosp_smmh.csv  
* 20141201_hosp_other.csv  
* 20141201_hosp_missing.csv  

</br>
</details>
<!--
NOTE: End of solution
-->



### Project structure

A few remarks here on folder structure:  

#### Folder structure  

* Typically, public health analysis folders will contain subfolders such as:  
     * data (often subdivided into "raw" and "clean", or by time period) 
     * scripts (or sometimes, just called "R")  
     * outputs  
     * images (if you are embedding images in your R documents)  

#### README files  

**Most folders should have a README file** that explains what lives in the folder, how it is updated, how it is used, etc.  

* In a finished project, the README should help users navigate and understand the contents.  
* In a project template, the README contains instructions for you to setup the project!  



**Now, add a .txt file that is named README.txt. Place the brief information that you learned above about where these data come from (the hospitals) in this file, and save it in the "raw" folder as README.txt.**  

You can do this by opening NotePad or a similar software, entering the text, and saving it in the folder. If you cannot find a plain text editor, you can use Microsoft Word.  


*Concepts in this section on project structure were borrowed from this [slide deck on project structure](https://slides.djnavarro.net/project-structure/#1) by DJ Navarro.*  




<!-- `r emo::ji("warning")` -->
<!-- `r emo::ji("bookmark")` -->






## Importing a dataset  

To begin working with data, you must import it into the R environment as an object.  

Once imported, the dataset will be saved as a **data frame** object, which consists of columns and rows.  


### Script organization  

Recall that often a script is run from top-to-bottom. Therefore, you will need to organize your script in a logical manner.  

Typically, you begin with loading packages, and then continue to importing data.  


### Location of the data  

**In order to import data into R, you must tell R where to access the data file on your computer (e.g. a specific folder).**  

This can be surprisingly difficult (e.g. when data are stored on shared drives). However, by saving the data *within our R project* the whole process becomes much easier.  




### rio - the easy package for importing data  

There are **base R** functions for importing data, but they can be confusing and difficult to remember - there are separate functions for each type of file (e.g. .xlsx, .csv, .tsv, .txt, etc).  

**Thankfully, there is one function that works for almost all file formats**, which is the `import()` function from the package **rio**.  

**Let us find our data file**  

Do you see the file "*surveillance_linelist_20141201.csv*" that is saved in the "root" project folder? This is the baseline folder - the same folder as the "*intro_course.Rproj*" file. To access the root folder from the R project file you do *not* need to click into any sub-directories (sub-folders).  

**Run the `import()` command**  

In its most simple form, the `import()` function accepts a character value - the file path to the data that you wish to import. In this case, the data file which we want to import is saved in the root folder, so you only need to provide the file name and extension, in quotation marks, as below:  


```{r, echo=T, eval=F}
import("surveillance_linelist_20141201.csv")
```


`r fontawesome::fa("exclamation", fill = "red")` Did you see this error?  

>Error in import("surveillance_linelist_20141201.csv") :  could not find function "import"  
>  
>If so, it means that you did not install and load the **rio** package. If you need help, review the previous section and look for the `pacman::p_load()` command that loads several packages including **rio**.  

Once you get the command to run successfully, you probably saw a lot of text appear in the **Console**. That was the dataset!

**Think: what did your command ask R to do?** It asked R to import the dataset... and the default action is to print/display it.  

You did not ask R to save the dataset as a named object. How would you do that?  

**In RStudio, try again to import the data and save it as the object `surv_raw` (a short name for "surveillance linelist raw").** 



<!--
NOTE: Below is the hint (all within details tags collapsed)
-->
<details>

<summary style='text-decoration: underline; color: darkgreen;'>`r fontawesome::fa("lightbulb", fill = "gold")` Click to read a hint</summary>
</br>

Use the assignment operator `<-` before the function. Don't forget quotation marks around the name of the file.  

</br>
</details>


<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
surv_raw <- import("surveillance_linelist_20141201.csv")
```

</br>
</details>
<!--
NOTE: End of solution
-->


You should now see the new object `surv_raw` appear in the R **Environment pane**, under the subcategory "Data". It should have a short description of the number of observations and variables. Congratulations, you have now imported a dataset into R!  


### Importing data from subfolders  

In most cases, it is better organizationally to store data in a subfolder - even perhaps by week, or by status as either "raw" or "clean". In this course, most of the data are initially stored in a subfolder named "data".  

`r fontawesome::fa("window-restore", fill = "darkgrey")` Now, go to your File Explorer to the root folder of the R project.  

**Cut the file *"surveillance_linelist_20141201.csv"* from the root folder, and paste it into the "data/raw" subfolder.**  


And so we are introduced to the topic of file paths.  

Any importing function needs to know *where* to look for the file that you want to import - this is the **file path**.  

A typical file path ("absolute" file path, or a "full" file path) may look like this:  

```{r, echo=T, eval=F}
surv_raw <- import("C:/Users/Laura/Documents/intro_course/data/surveillance_linelist_20141201.csv")
```

The problem with this is all of the path before "intro_course" ... the C: ... the "Laura" ... etc. None of these may be present in the computer of Laura's colleague, and this command would not run. The file path would be "broken". Or, the next user may be using a Mac, so the slashes would all need to be reversed! Thankfully there is a solution:  



### The {here} package and relative file paths  

The package {here} and its function `here()` make it easy to tell R where to find and to save your files - in essence, it builds *relative file paths*.

Used in conjunction with an RStudio project, {here} allows you to describe the location of files in your RStudio project *in relation to the project’s root directory (the top-level folder)*. This is useful when the project may be shared or accessed by multiple people/computers or when a script may be moved around.  
Used with an R project, it prevents complications due to the unique file paths on different computers (e.g. "C:/Users/Laura/Documents...") by “starting” the file path in a place common to all users (the project root).  


`r fontawesome::fa("terminal", fill = "black")` Make sure you have installed and loaded the package {here}. Then try running the command `here()` - leave the parentheses empty. What do you see?  

In "Laura"'s situation, the output might look like this:  

```{r, echo=T, eval=F}
"C:/Users/Laura/Documents/intro_course")
```

`here()` has automatically created the full file path that comes before the RStudio project root folder ("intro_course").  

It is easy to add sub-folders at the end of the path, like this:  

```{r, echo=T, eval=F}
here("data", "raw")
```

This would produce the file path:  

```{r, echo=T, eval=F}
"C:/Users/Laura/Documents/intro_course/data/raw")
```

Ending the `here()` command with a file **name and extension** could look like this:  

```{r, echo=T, eval=F}
here("data", "raw", "surveillance_linelist_20141201.csv")
```

This would produce the file path:  

```{r, echo=T, eval=F}
"C:/Users/Laura/Documents/intro_course/data/raw/surveillance_linelist_20141201.csv")
```

Now comes the secret combination: we insert this `here()` command *into* the `import()` command! We nest one function inside another one! Take a look at this:  

```{r, echo = T, eval=F}
# import the file from the "data" and "raw" subfolders
surv_raw <- import(here("data", "raw", "surveillance_linelist_20141201.csv"))
```

Note the two parentheses at the end - one for each function. The file path returned by `here()` is passed to the first argument of `import()` as a character value.  

#### A note on slashes  

You may wonder - where are the forward slashes and back slashes in the `here()` command? Well, `here()` allows the slack-agnostic entry format above because it can adapt to whether you are working on a Mac or a PC!  

On a PC:  

* project/data/linelist_20141201.csv  
* project/data/linelist_20141208.csv  

On a Mac:  

* project\data\linelist_20141201.csv  
* project\data\linelist_20141208.csv  

You do not know who will be using your script later, or what kind of computer they will have. Therefore, it is easier to simply go with: `here("data", "linelist_20141201.csv")`.  


### Import from a subfolder  


`r fontawesome::fa("terminal", fill = "black")` Now in RStudio, write a command to import "surveillance_linelist_20141201.csv" from the subfolder "data/raw" (where you moved it, earlier) and save it in R as `surv_raw` using the assignment operator.  


<!--
NOTE: Below is the hint (all within details tags collapsed)
-->
<details>

<summary style='text-decoration: underline; color: darkgreen;'>`r fontawesome::fa("lightbulb", fill = "gold")` Click to read a hint</summary>
</br>

Begin the command with the object name that you want to assign, then the assignment operator, and then the `import()` command. Within the `import()` parentheses, place the `here()` function, which should list the names of the sub-folders (in quotes) and include the file name with extension (.csv).  

</br>
</details>


<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
surv_raw <- import(here("data", "raw", "surveillance_linelist_20141201.csv"))
```

</br>
</details>
<!--
NOTE: End of solution
-->






```{r quiz-data-import}
quiz(caption = "Quiz - importing",
  question("How would you write the import() and here() command for the following filepath (assuming the R project is located in the folder 'malaria')?:\n\nE:/Mario/My Documents/R stuff/malaria/received/wk22/cases.csv",
    allow_retry = T,
    answer("import() here('received/wk22/cases.csv')", message = "No, the here() function must be nested within the import() function."),
    answer("import(here('received', 'wk22', 'cases', '.csv'))", message = "No, include the file extension with the file name."),
    answer("here(import('received', 'wk22', 'cases.csv'))", message = "No, the here() function must be nested within the import() function, because it is providing the file path to it."),
    answer("import(here('received', 'wk22', 'cases.csv'))", correct = T)
  )
)
```









## Review a dataset  

Now that you have imported the data, let's take a look!  


### Take a peek  

`r fontawesome::fa("eye", fill = "darkblue")` The dataset is now saved as a data frame object in the RStudio **Environment pane**. Find its name there, and click once on the blue circle next to the name. What do you see?  

The expanded area beneath the data frame is an overview of all the columns in the data frame. After the name of the column, there is a colon, then an abbreviation that indicates the "class" of the column (we'll discuss this more later), and then the first few values in the column. How exciting!  

For even more detail, collapse this overview and **click on the name of the data frame itself (`surv_raw`).**  

This should open a new tab in the upper-left pane, next to the R script. This tab will display the data frame! You can scroll through the data frame, and even apply filters (see the icon in the upper-left of the display).  

Try these exercises:  

```{r quiz-data-review}
quiz(caption = "Quiz - data review",
  question("How many columns are there in the data frame?",
    allow_retry = T,
    answer("665", message = "No, this is the number of rows/observations"),
    answer("21", correct = TRUE, message = "Yes this is correct!"),
    answer("19", message = "This is not correct, try again."),
    answer("25", message = "No, this is the number of rows shown in the initial display")
  ),

  question("What is the value in the 4th column and the 50th row?",
    allow_retry = T,
    answer("m", correct = TRUE),
    answer("Port Hospital"),
    answer("38.3"),
    answer("West II")
  ),

  question("How many of the rows include a weight between 40 and 45 kg?",
    allow_retry = T,
        answer("112"),
        answer("65", correct = TRUE),
        answer("226"),
        answer("95")
  )
)
```


### Indexing  

Above we asked you to find the value in the 4th column, and the 50th row. Instead of searching manually, you can also write code to isolate and view pieces of the dataframe.  

**The `$` operator can be used on a dataframe to reference a specific column.** It is one of the indexing operators in R, which returns a sub-part of a larger object. For example, `surv_raw$gender` will return the entire column `gender`.  

**Try typing and running the following commands**  

* `surv_raw$hospital`  
* `surv_raw$case_id`

As you typed, slowly, did you see anything appear as you arrived at typing the `$`? You should have seen a small menu appear that showed all the columns in the data frame `surv_raw`. Using your arrow keys you can select a column from that menu - if you do not want to type the rest and potentially make a spelling mistake.  

**Try writing commands to show other columns, and experiment with this pop-up menu**.  

Here is something you should know: columns can also be referred to as "vectors" - vectors are a long line of values of the same class. So in fact, a data frame is simply a collection of vectors (column!). You can also create other, independent vectors, like you have already done with `c()`. But most commonly, you will work with vectors in the context of a data frame. "Vector" is a good term to know.  

Another indexing operator to be aware of is the "square brackets" that look like `[ ]`. These brackets can also be used to isolate/return a sub-part of a larger object: `dataframe[ROW, COLUMN]`  
This command would return the value at the 12th row and the 4th column: `surv_raw[12, 4]`  

You can return an entire column by leaving the ROWS part empty (but don't forget the comma!):  `surv_raw[ ,4]`  
Or an entire row by doing the opposite: `surv_raw[12, ]`  

Other objects can be subset as well. For example, the `summary()` function when used on a column returns an object that contains the minimum, median, mean, IQR, etc.  

Try these three commands in R to see how the output changes as further indexing is applied:  

```{r, echo=T}
# Return the summary of the column 'age'
summary(surv_raw$age)

# Return the 3rd element of the summary
summary(surv_raw$age)[3]

# Return the number only, of the 3rd element of the summary
summary(surv_raw$age)[[3]]

# Do something with the number
summary(surv_raw$age)[[3]] + 4
```

You will use the `$` very frequently. It is less common to need the brackets. But still - good to know about in case you see them or need to use them.  




### Skim  

You can return a good summary of the dataset using the R package {skimr} and its function `skim()`.  

Use `p_load(skimr)` or `install.packages("skimr")` to install this package and load it for use.  

If you encounter any errors when trying to install the package, notify your facilitator.  

Place the name of the linelist in `skim()` and run. What content appears in the R console?
  
If the output is not easily readable, expand your Console pane to be wider, and run the command again.  



<!--
NOTE: Below is the solution (all within details tags collapsed)
-->

<details>
<summary style='text-decoration: underline; color: red;'>`r fontawesome::fa("check", fill = "red")`Click to see a solution (try it yourself first!)</summary>
</br>

```{r eval = F, echo=T}
skim(surv_raw)
```

</br>
</details>
<!--
NOTE: End of solution
-->








**What does the output show?**  

```{r quiz-skim}
quiz(caption = "Quiz - reviewing the data",
  question("How many columns has R classified as numeric?",
    allow_retry = T,
    answer("32", message = "No, this is more than the columns in the dataset!"),
    answer("6", correct = TRUE, message = "Yes this is correct!"),
    answer("13", message = "No, this is the number of columns of class character"),
    answer("1", message = "No, this is the number of columns that are POSIXct - a type of date format")
  ),

  question("Review the information on character columns. What is the number of unique values in the hospital column?",
    allow_retry = T,
    answer("9", correct = TRUE),
    answer("Port Hospital"),
    answer("3"),
    answer("8")
  ),

  question("Review the information on numeric columns. What is the median age?",
    allow_retry = T,
        answer("32.2"),
        answer("13", correct = TRUE),
        answer("1250"),
        answer("99.0")
  )
)
```





## End  

Congratulations! You have completed the first exercise in this course!  

Be sure to save your R script, and check-in with your facilitator.  

If you still have time remaining, try installing the package {praise} and see what its function `praise()` does.  
















